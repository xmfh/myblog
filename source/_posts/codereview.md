---
title:  Code Reveiw
---

一直以来代码走查的效果都很不理想， 如何有效的提高代码的质量。 网上都在说Code Review，如何真正的吧Code Review落地呢？

## 目标
- 提高代码质量
- 提前发现bug
- 使代码遵循团队开发规范
- 找到代码中实现比较复杂的地方，便于框架改进。

在《谷歌是如果做代码审查的》一文中的描述：
>代码审查的最大的功用是纯社会性的。如果你在编程，而且知道将会有同事检查你的代码，你编程态度就完全不一样了。你写出的代码将更加整洁，有更好的注释，更好的程序结构——因为你知道，那个你很在意的人将会查看你的程序。

人的心态是这样， 我代码写的很差，如果让其他同事看到，那么其他同事肯定会觉得我这个人编码能力很差。而另外一方面还可以培养程序员对代码的阅读能力。毕竟如果看多了**坏味道**的代码，一看好代码，马上就会知道，自己的代码应该写成这样更好。

> 还有一个非常重要的好处。代码审查能传播知识。在很多的开发团队里，经常每一个人负责一个核心模块，每个人都只关注他自己的那个模块。除非是同事的模块影响了自己的程序，他们从不相互交流。

系统框架中很多核心的用法，以及很多技巧是无法通过培训来完全覆盖到的，通过代码走查可以让其他同事了解这部分的内容，也可以对以后的功能业务逻辑进行了解。


### 提高代码质量
- 有可能引起性能的查询问题。
- 是否会创建大量的线程，造成服务器卡死。
- 是否存在并发的问题。
- Magic Numbers

### 提前发现Bug
- 是否存在写死的后台路径，或者上传路径等，根据系统配置的可变化值。
- 业务逻辑可能存在的问题。
- 调用的方法不正确，或有更好的调用方式。

### 遵循团队开发规范
- C# Style Guide：StackOverflow 上的C#风格指南 Q & A。-[官网](http://stackoverflow.com/questions/4678178/style-guide-for-c)。
- C# Coding Conventions：MSDN 官方的 C# 代码约定。-[官网](https://msdn.microsoft.com/en-us/library/ff926074.aspx)。
- 尽量遵循Resharper给出的建议。
- 能够通过StyleCop检查。
- HTML的命名 应该遵循`BEM`命名规范。 （不确定，但实践下来感觉这种规范可实施性上是最强的）。
- js 最低标准是使用严格模式，尽量通过jsHint的检查。

### 框架改进
开发人员不会每次都报告框架哪里比较难用， 经常使用很多奇淫巧技来处理问题。但开发中出现的各种问题，或者比较复杂的业务逻辑，正是框架应该进行处理的部分。 

## 范围
每次检查的的范围是多少， 是按照迭代来进行走查，还是应该模块完成后进行走查？ 所有的代码是否都要经过组长或者他人评审才迁入？

- 正常来说应该某个功能模块的迭代周期结束后，可以进行`CodeReview`，如果各组相互交叉，从理论上来说，能够覆盖的面积是最大的，但从单个的执行效果上来讲反而是最差的。在执行时，应该可以交叉走查和重点走查相结合的方式。 单周交叉走查，双周重点走查。 以解决很多代码组长基本没有时间审核的问题。

- 所有的代码是否都要经过组长或者他人评审才迁入？
    作为TFS中进行操作，暂时还是没有所有的功能模块都进行分支开发的。 一来比较占用空间，二来合并时也比较麻烦，所以不存在向主版本进行推送的问题。 而现在TFS的签入策略 中也没有必须经过代码评审的过程。

## Tools
Code Review中主要的问题 ，就是要在代码上做评论， 之后还要能追溯到代码修改后的状态。 所有要修改的代码是否确实有效的进行了调整。网上的一些代码审核工具：
- Gerrit
- TFS中的代码审核。
- Phabricator

Greeit是基于Git的，跟我们现在的TFS托管代码的环境还是不太一样，上手成本太高，暂时补考虑。
Phabricator 网上的反应都不错，但是相对来说成本较高。 代码审核本身是个过程，如果过分的追逐工具，反而本末倒置。

### 其他的质量工具
- jshint

## 参考资料
- [Google是如果做代码审查的](http://www.vaikan.com/things-everyone-should-do-code-review/)
- [Code Review 程序员的寄望与哀伤](http://www.cnblogs.com/mindwind/p/5639008.html)
- [我们是怎么做CodeReview的](http://www.cnblogs.com/wenhx/p/How-We-Code-Review.html)
- [知乎CodeReview热门话题](https://www.zhihu.com/topic/19668200/hot)
- [大家的公司的code review都是怎么做的？遇到过什么问题么？](https://www.zhihu.com/question/41089988)


